<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒ‘ã‚¿ãƒ¼ãƒ³A: èˆˆå‘³ãƒ™ãƒ¼ã‚¹ - ãƒ’ã‚«ãƒªãƒã‚¹ã‚¿ã‚¸ã‚ª LINE ãƒ‡ãƒ¢</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, 'Hiragino Sans', sans-serif; background: #7494C0; display: flex; justify-content: center; padding: 20px 10px; }
.phone { width: 390px; height: 844px; background: #fff; border-radius: 40px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.3); display: flex; flex-direction: column; }
.header { background: #fff; padding: 50px 16px 12px; display: flex; align-items: center; gap: 12px; border-bottom: 1px solid #e5e5e5; flex-shrink: 0; }
.header .back { font-size: 24px; color: #06C755; cursor: pointer; }
.header .avatar { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #ff6b9d, #ff8fab); display: flex; align-items: center; justify-content: center; color: #fff; font-size: 14px; font-weight: bold; }
.header .name { font-size: 16px; font-weight: 600; }
.header .badge { background: #06C755; color: #fff; font-size: 9px; padding: 2px 6px; border-radius: 8px; margin-left: 4px; }
.chat { flex: 1; overflow-y: auto; padding: 16px; display: flex; flex-direction: column; gap: 8px; background: #7494C0; }
.msg { max-width: 80%; animation: fadeIn 0.3s ease; }
.msg.bot { align-self: flex-start; }
.msg.user { align-self: flex-end; }
.msg .bubble { padding: 10px 14px; border-radius: 18px; font-size: 14px; line-height: 1.6; word-break: break-word; }
.msg.bot .bubble { background: #fff; color: #333; border-bottom-left-radius: 4px; }
.msg.user .bubble { background: #06C755; color: #fff; border-bottom-right-radius: 4px; }
.msg .time { font-size: 10px; color: rgba(255,255,255,0.7); margin-top: 2px; padding: 0 4px; }
.msg.bot .time { text-align: left; }
.msg.user .time { text-align: right; }
.choices { display: flex; flex-direction: column; gap: 8px; max-width: 85%; align-self: flex-start; animation: fadeIn 0.3s ease; }
.choices button { background: #fff; border: 2px solid #06C755; color: #06C755; padding: 12px 20px; border-radius: 24px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; text-align: left; }
.choices button:hover { background: #06C755; color: #fff; }
.choices button:active { transform: scale(0.97); }
.carousel { display: flex; gap: 10px; overflow-x: auto; padding: 4px 0 8px; max-width: 100%; align-self: flex-start; animation: fadeIn 0.3s ease; scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch; }
.carousel::-webkit-scrollbar { display: none; }
.card { min-width: 240px; max-width: 240px; background: #fff; border-radius: 14px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.08); scroll-snap-align: start; flex-shrink: 0; }
.card img { width: 100%; height: 150px; object-fit: cover; background: linear-gradient(135deg, #ffeef5, #fff5f8); display: flex; align-items: center; justify-content: center; }
.card .card-body { padding: 12px; }
.card .card-body h4 { font-size: 14px; margin-bottom: 6px; color: #333; }
.card .card-body p { font-size: 12px; color: #666; line-height: 1.5; margin-bottom: 8px; }
.card .card-body .price { font-size: 18px; font-weight: 700; color: #ff6b9d; }
.card .card-body .price span { font-size: 11px; font-weight: 400; color: #999; }
.card .card-btn { display: block; text-align: center; padding: 10px; background: #06C755; color: #fff; font-size: 13px; font-weight: 600; cursor: pointer; border: none; width: 100%; transition: background 0.2s; }
.card .card-btn:hover { background: #05b04c; }
.rich-msg { max-width: 85%; align-self: flex-start; background: #fff; border-radius: 14px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.08); animation: fadeIn 0.3s ease; }
.rich-msg .rich-header { background: linear-gradient(135deg, #ff6b9d, #ff8fab); padding: 16px; color: #fff; }
.rich-msg .rich-header h3 { font-size: 16px; margin-bottom: 4px; }
.rich-msg .rich-header p { font-size: 12px; opacity: 0.9; }
.rich-msg .rich-body { padding: 14px; }
.rich-msg .rich-body .feat { display: flex; align-items: center; gap: 8px; padding: 6px 0; font-size: 13px; color: #555; }
.rich-msg .rich-body .feat::before { content: "âœ“"; color: #06C755; font-weight: bold; font-size: 16px; }
.rich-msg .social-proof { background: #fff9fb; padding: 10px 14px; font-size: 12px; color: #ff6b9d; font-weight: 500; border-top: 1px solid #ffeef5; }
.rich-msg .cta-row { display: flex; border-top: 1px solid #eee; }
.rich-msg .cta-row button { flex: 1; padding: 12px; border: none; font-size: 13px; font-weight: 600; cursor: pointer; transition: background 0.2s; }
.rich-msg .cta-row .cta-primary { background: #06C755; color: #fff; }
.rich-msg .cta-row .cta-primary:hover { background: #05b04c; }
.rich-msg .cta-row .cta-secondary { background: #fff; color: #06C755; }
.rich-msg .cta-row .cta-secondary:hover { background: #f0faf4; }
.step-indicator { text-align: center; padding: 8px; font-size: 11px; color: rgba(255,255,255,0.7); }
.typing { align-self: flex-start; animation: fadeIn 0.3s ease; }
.typing .bubble { background: #fff; border-radius: 18px; border-bottom-left-radius: 4px; padding: 12px 18px; display: flex; gap: 4px; }
.typing .dot { width: 8px; height: 8px; background: #ccc; border-radius: 50%; animation: typingDot 1.4s infinite; }
.typing .dot:nth-child(2) { animation-delay: 0.2s; }
.typing .dot:nth-child(3) { animation-delay: 0.4s; }
.hidden { display: none !important; }
.input-bar { background: #fff; padding: 8px 12px 30px; display: flex; align-items: center; gap: 8px; border-top: 1px solid #e5e5e5; flex-shrink: 0; }
.input-bar input { flex: 1; padding: 10px 16px; border: 1px solid #ddd; border-radius: 20px; font-size: 14px; outline: none; }
.input-bar .send { width: 36px; height: 36px; background: #06C755; border: none; border-radius: 50%; color: #fff; font-size: 18px; cursor: pointer; }
.debug-bar { background: #333; color: #aaa; padding: 8px 16px; font-size: 11px; display: flex; justify-content: space-between; flex-shrink: 0; }
.debug-bar .reset { color: #ff6b6b; cursor: pointer; text-decoration: underline; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
@keyframes typingDot { 0%, 60%, 100% { transform: translateY(0); } 30% { transform: translateY(-6px); } }
.photo-placeholder { width: 100%; height: 150px; background: linear-gradient(135deg, #ffeef5, #fff5f8); display: flex; align-items: center; justify-content: center; color: #ff6b9d; font-size: 40px; }
</style>
</head>
<body>
<div class="phone">
  <div class="header">
    <span class="back">&lsaquo;</span>
    <div class="avatar">H</div>
    <div>
      <span class="name">ãƒ’ã‚«ãƒªãƒã‚¹ã‚¿ã‚¸ã‚ª</span>
      <span class="badge">å…¬å¼</span>
    </div>
  </div>
  <div class="chat" id="chat">
    <!-- Messages will be injected here -->
  </div>
  <div class="input-bar">
    <input type="text" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›" disabled>
    <button class="send">&#9654;</button>
  </div>
  <div class="debug-bar">
    <span>ãƒ‘ã‚¿ãƒ¼ãƒ³A: èˆˆå‘³ãƒ™ãƒ¼ã‚¹ï¼ˆWhatå‹ï¼‰</span>
    <span class="reset" onclick="resetFlow()">ãƒªã‚»ãƒƒãƒˆ</span>
  </div>
</div>

<script>
const chat = document.getElementById('chat');
let currentStep = 0;

const PLANS = {
  newborn: {
    name: 'ãƒ‹ãƒ¥ãƒ¼ãƒœãƒ¼ãƒ³æ’®å½±',
    emoji: 'ğŸ‘¶',
    price: '38,500',
    features: ['ğŸ’° æ˜æœ—ä¼šè¨ˆãƒ»å¤§æ‰‹ã®åŠé¡', '50ã‚«ãƒƒãƒˆï¼ˆãƒ¬ã‚¿ãƒƒãƒ10+èª¿æ•´40ï¼‰', 'è¡£è£…ãƒ»å°ç‰©ã™ã¹ã¦ç„¡æ–™', 'å®Œå…¨è²¸åˆ‡ ç´„1æ™‚é–“45åˆ†', 'å®¶æ—å†™çœŸãƒ»å…„å¼Ÿæ’®å½±OK'],
    proof: 'å¹´é–“500çµ„ä»¥ä¸Šã®ãƒãƒãŒæ’®å½±',
    cards: [
      { title: 'ã‚¹ã‚¿ã‚¸ã‚ªplan', desc: 'èµ¤ã¡ã‚ƒã‚“ãƒ»å®¶æ—ãƒ»å…„å¼Ÿã®3ã‚·ãƒ¼ãƒ³æ’®å½±ã€‚è¡£è£…ãƒ»å°ç‰©ã™ã¹ã¦ç„¡æ–™ã€‚', price: '38,500', icon: 'ğŸ“¸' },
      { title: 'ãƒŠãƒãƒ¥ãƒ©ãƒ«å‡ºå¼µ', desc: 'ã”è‡ªå®…ã§ã®è‡ªç„¶å…‰æ’®å½±ã€‚å®®å´å¸‚å†…å‡ºå¼µç„¡æ–™ã€‚æœŸé–“é™å®šã€‚', price: '19,000', icon: 'ğŸ ' },
      { title: 'å‡ºå¼µãƒ™ãƒ¼ã‚·ãƒƒã‚¯', desc: '3ç€3ã‚·ãƒ¼ãƒ³ã€‚ã˜ã£ãã‚Šæ’®å½±ã—ãŸã„æ–¹ã«ã€‚', price: '53,900', icon: 'ğŸŒ¿' }
    ]
  },
  omiyamairi: {
    name: 'ãŠå®®å‚ã‚Šæ’®å½±',
    emoji: 'â›©ï¸',
    price: '33,000',
    features: ['ğŸ’° æ˜æœ—ä¼šè¨ˆãƒ»å¤§æ‰‹ã®åŠé¡', '60ã‚«ãƒƒãƒˆï¼ˆæ˜ã‚‹ã•ãƒ»è‰²å‘³èª¿æ•´æ¸ˆã¿ï¼‰', 'ç”£ç€ãƒ¬ãƒ³ã‚¿ãƒ«ç„¡æ–™', 'ğŸ‘˜ è¨ªå•ç€ï¼šãƒ™ãƒ¼ã‚·ãƒƒã‚¯ç„¡æ–™/ãƒ­ã‚±+Â¥16,500', 'â­ï¸ å…„å¼Ÿè¡£è£…1ç€ç„¡æ–™', 'â›©ï¸ ç¥ç¤¾ãƒ­ã‚±ï¼ˆ1æ—¥ã§å®Œçµï¼‰'],
    proof: 'ç”£ç€ãƒ»è¨ªå•ç€ã®ç€ä»˜ã‘ã‚‚ã‚¹ã‚¿ãƒƒãƒ•ãŒå¯¾å¿œ',
    cards: [
      { title: 'ãƒ™ãƒ¼ã‚·ãƒƒã‚¯ãƒ—ãƒ©ãƒ³', desc: 'ç”£ç€+æ´‹è£…ç„¡æ–™ã€‚è¨ªå•ç€ã‚‚ç„¡æ–™ã€‚', price: '33,000', icon: 'ğŸ‘˜' },
      { title: 'ã‚¹ã‚¿ã‚¸ã‚ªï¼‹ãƒ­ã‚±', desc: 'ã‚¹ã‚¿ã‚¸ã‚ªæ’®å½±å¾Œã€ç¥ç¤¾ã§å®¶æ—å†™çœŸã€‚1æ—¥ã§å®Œçµã€‚', price: '33,000', icon: 'â›©ï¸' },
      { title: 'è¨ªå•ç€ãƒ¬ãƒ³ã‚¿ãƒ«', desc: 'ãƒ™ãƒ¼ã‚·ãƒƒã‚¯ç„¡æ–™/ãƒ­ã‚±+Â¥16,500ï¼ˆç€ä»˜ã‘è¾¼ï¼‰', price: 'ãƒ—ãƒ©ãƒ³ã«ã‚ˆã‚‹', icon: 'ğŸ€' }
    ]
  },
  shichigosan: {
    name: 'ä¸ƒäº”ä¸‰æ’®å½±',
    emoji: 'ğŸ',
    price: '35,000',
    features: ['ğŸ’° æ˜æœ—ä¼šè¨ˆãƒ»å¤§æ‰‹ã®åŠé¡', '60ã‚«ãƒƒãƒˆæ’®å½±', 'ãƒ˜ã‚¢ãƒ¡ã‚¤ã‚¯ãƒ»ç€ä»˜ã‘è¾¼ã¿', 'ç€ç‰©+æ´‹è£…ã®2ç€å¯¾å¿œ', 'â­ï¸ å…„å¼Ÿã‚‚ç€ç‰©ç€ç”¨å¯èƒ½', 'ğŸ‘˜ è¨ªå•ç€ +Â¥11,000ï¼ˆç€ä»˜ã‘è¾¼ï¼‰', 'â›©ï¸ å®®å´ç¥å®®ãƒ»ç¥æŸ±å®®ã§ãƒ­ã‚±å¯èƒ½'],
    proof: 'å‰æ’®ã‚Šãªã‚‰è¡£è£…é¸ã³æ”¾é¡Œ',
    cards: [
      { title: 'ç€ç‰©&æ´‹è£…ãƒ—ãƒ©ãƒ³', desc: 'ç€ç‰©1ç€+æ´‹è£…1ç€ã€‚ãƒ˜ã‚¢ãƒ¡ã‚¤ã‚¯ç€ä»˜ã‘è¾¼ã¿ã€‚', price: '35,000', icon: 'ğŸ‘§' },
      { title: 'ã‚¹ã‚¿ã‚¸ã‚ªï¼‹ãƒ­ã‚±', desc: 'ã‚¹ã‚¿ã‚¸ã‚ªâ†’ç¥ç¤¾ã®ã‚»ãƒƒãƒˆã€‚1æ—¥ã§å®Œçµã€‚', price: '35,000~', icon: 'â›©ï¸' },
      { title: 'å…„å¼Ÿã‚‚ç€ç‰©æ’®å½±', desc: 'å…„å¼Ÿã‚‚ç€ç‰©ãŒç€ã‚‰ã‚Œã¾ã™ã€‚', price: 'ãƒ—ãƒ©ãƒ³ã«å«ã‚€', icon: 'ğŸ‘¦' }
    ]
  },
  birthday: {
    name: 'ãƒãƒ¼ã‚¹ãƒ‡ãƒ¼æ’®å½±',
    emoji: 'ğŸ‚',
    price: '33,000',
    features: ['ğŸ’° æ˜æœ—ä¼šè¨ˆãƒ»å¤§æ‰‹ã®åŠé¡', '60ã‚«ãƒƒãƒˆæ’®å½±', 'è¡£è£…2ç€', 'â­ï¸ å…„å¼Ÿè¡£è£…1ç€ç„¡æ–™', 'ğŸ‘˜ è¨ªå•ç€ +Â¥11,000ï¼ˆç€ä»˜ã‘è¾¼ï¼‰'],
    proof: 'è¡£è£…ãƒã‚§ãƒ³ã‚¸ã§2ã¤ã®é›°å›²æ°—ã‚’æ¥½ã—ã‚ã¾ã™',
    cards: [
      { title: 'ãƒãƒ¼ã‚¹ãƒ‡ãƒ¼ãƒ—ãƒ©ãƒ³', desc: 'è¡£è£…2ç€ã§2ã‚·ãƒ¼ãƒ³ã€‚å…„å¼Ÿã‚‚ä¸€ç·’ã«æ’®å½±OKã€‚', price: '33,000', icon: 'ğŸ‚' },
      { title: 'å…„å¼Ÿæ’®å½±è¿½åŠ ', desc: 'å…„å¼Ÿã®ã‚½ãƒ­ã‚«ãƒƒãƒˆã‚‚ä¸€ç·’ã«ã€‚', price: '+16,500', icon: 'ğŸ‘¶' }
    ]
  }
};

function addMsg(type, text, delay) {
  return new Promise(resolve => {
    if (type === 'bot') {
      const typing = document.createElement('div');
      typing.className = 'typing';
      typing.innerHTML = '<div class="bubble"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>';
      chat.appendChild(typing);
      scrollDown();
      setTimeout(() => {
        typing.remove();
        const div = document.createElement('div');
        div.className = 'msg bot';
        div.innerHTML = `<div class="bubble">${text}</div><div class="time">${getTime()}</div>`;
        chat.appendChild(div);
        scrollDown();
        resolve();
      }, delay || 800);
    } else {
      const div = document.createElement('div');
      div.className = 'msg user';
      div.innerHTML = `<div class="bubble">${text}</div><div class="time">${getTime()}</div>`;
      chat.appendChild(div);
      scrollDown();
      setTimeout(resolve, 300);
    }
  });
}

function addChoices(options, callback) {
  const div = document.createElement('div');
  div.className = 'choices';
  options.forEach(opt => {
    const btn = document.createElement('button');
    btn.textContent = opt.label;
    btn.onclick = () => {
      div.remove();
      addMsg('user', opt.label).then(() => callback(opt.value));
    };
    div.appendChild(btn);
  });
  chat.appendChild(div);
  scrollDown();
}

function addCarousel(cards, callback) {
  const div = document.createElement('div');
  div.className = 'carousel';
  cards.forEach(card => {
    const c = document.createElement('div');
    c.className = 'card';
    c.innerHTML = `
      <div class="photo-placeholder">${card.icon}</div>
      <div class="card-body">
        <h4>${card.title}</h4>
        <p>${card.desc}</p>
        <div class="price">&yen;${card.price}<span>ï¼ˆç¨è¾¼ï¼‰</span></div>
      </div>
      <button class="card-btn" onclick="this.closest('.carousel').remove()">è©³ã—ãè¦‹ã‚‹</button>
    `;
    c.querySelector('.card-btn').addEventListener('click', () => callback(card));
    div.appendChild(c);
  });
  chat.appendChild(div);
  scrollDown();
}

function addRichMsg(plan) {
  const div = document.createElement('div');
  div.className = 'rich-msg';
  div.innerHTML = `
    <div class="rich-header">
      <h3>${plan.emoji} ${plan.name}</h3>
      <p>&yen;${plan.price}ã€œï¼ˆç¨è¾¼ï¼‰</p>
    </div>
    <div class="rich-body">
      ${plan.features.map(f => `<div class="feat">${f}</div>`).join('')}
    </div>
    <div class="social-proof">${plan.proof}</div>
    <div class="cta-row">
      <button class="cta-primary" onclick="handleCTA('reservation')">ç©ºãçŠ¶æ³ã‚’è¦‹ã‚‹</button>
      <button class="cta-secondary" onclick="handleCTA('consult')">LINEã§ç›¸è«‡</button>
    </div>
  `;
  chat.appendChild(div);
  scrollDown();
}

function addStepIndicator(text) {
  const div = document.createElement('div');
  div.className = 'step-indicator';
  div.textContent = text;
  chat.appendChild(div);
  scrollDown();
}

function scrollDown() {
  setTimeout(() => chat.scrollTop = chat.scrollHeight, 50);
}

function getTime() {
  const now = new Date();
  return `${now.getHours()}:${String(now.getMinutes()).padStart(2, '0')}`;
}

// === FLOW ===

async function startFlow() {
  addStepIndicator('â€” Step 1: èˆˆå‘³ã®æŠŠæ¡ â€”');
  await addMsg('bot', 'ãƒ’ã‚«ãƒªãƒã‚¹ã‚¿ã‚¸ã‚ªå…¬å¼LINEã¸ã‚ˆã†ã“ãï¼\n\nãŠå­æ§˜ã®ã‹ã‘ãŒãˆã®ãªã„ç¬é–“ã‚’ã€ãƒ—ãƒ­ã®æ’®å½±ã§æ®‹ã—ã¾ã›ã‚“ã‹ï¼Ÿ');
  await addMsg('bot', 'ã©ã‚“ãªæ’®å½±ã«èˆˆå‘³ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ', 600);

  addChoices([
    { label: 'ğŸ‘¶ ãƒ‹ãƒ¥ãƒ¼ãƒœãƒ¼ãƒ³ï¼ˆæ–°ç”Ÿå…ï¼‰', value: 'newborn' },
    { label: 'â›©ï¸ ãŠå®®å‚ã‚Šãƒ»ãŠé£Ÿã„åˆã‚', value: 'omiyamairi' },
    { label: 'ğŸ ä¸ƒäº”ä¸‰', value: 'shichigosan' },
    { label: 'ğŸ‚ ãƒãƒ¼ã‚¹ãƒ‡ãƒ¼ãƒ»è¨˜å¿µæ—¥', value: 'birthday' }
  ], handleInterest);
}

async function handleInterest(planKey) {
  currentStep = 1;
  const plan = PLANS[planKey];

  addStepIndicator('â€” Step 2: ãƒ—ãƒ©ãƒ³ç´¹ä»‹ â€”');
  await addMsg('bot', `${plan.emoji} ${plan.name}ã§ã™ã­ï¼\n\nç´ æ•µãªé¸æŠã§ã™ã€‚ãƒ’ã‚«ãƒªãƒã‚¹ã‚¿ã‚¸ã‚ªã§ã¯å®Œå…¨è²¸åˆ‡ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆç©ºé–“ã§ã€ã‚†ã£ãŸã‚Šæ’®å½±ã§ãã¾ã™ã€‚`);
  await addMsg('bot', 'ã“ã¡ã‚‰ã®ãƒ—ãƒ©ãƒ³ã‚’ã”ç”¨æ„ã—ã¦ã„ã¾ã™', 600);

  addCarousel(plan.cards, (card) => handleCardSelect(planKey, card));
}

async function handleCardSelect(planKey, card) {
  currentStep = 2;
  const plan = PLANS[planKey];

  addStepIndicator('â€” Step 3: è©³ç´°ãƒ»å£ã‚³ãƒŸ â€”');
  await addMsg('bot', `ã€Œ${card.title}ã€ã‚’ãŠé¸ã³ã„ãŸã ãã¾ã—ãŸï¼`);

  // Add studio selection for relevant plans
  if (planKey === 'omiyamairi' || planKey === 'shichigosan') {
    await addMsg('bot', 'ã©ã¡ã‚‰ã®ã‚¹ã‚¿ã‚¸ã‚ªã‚’ã”å¸Œæœ›ã§ã™ã‹ï¼Ÿ\n\nç¥ç¤¾ãƒ­ã‚±ãªã‚‰æ’®å½±å½“æ—¥ã«ãã®ã¾ã¾ãŠå‚ã‚Šã§ãã¾ã™ã€‚', 600);
    addChoices([
      { label: 'ğŸ“ ä¸‹åŒ—æ–¹ã‚¹ã‚¿ã‚¸ã‚ªï¼ˆå®®å´å¸‚ï¼‰â†’ å®®å´ç¥å®®', value: 'shimokitakata' },
      { label: 'ğŸ“ éƒ½åŸã‚¹ã‚¿ã‚¸ã‚ª â†’ ç¥æŸ±å®®', value: 'miyakonojo' },
      { label: 'ğŸ¤” ã¾ã æ±ºã‚ã¦ã„ãªã„', value: 'undecided' }
    ], (studio) => handleStudioSelect(planKey, studio));
  } else {
    showRichMessage(planKey);
  }
}

async function handleStudioSelect(planKey, studio) {
  const studioNames = {
    shimokitakata: 'ä¸‹åŒ—æ–¹ã‚¹ã‚¿ã‚¸ã‚ªï¼ˆå®®å´ç¥å®®ã¾ã§è»Š5åˆ†ï¼‰',
    miyakonojo: 'éƒ½åŸã‚¹ã‚¿ã‚¸ã‚ªï¼ˆç¥æŸ±å®®ã¾ã§è»Š5åˆ†ï¼‰',
    undecided: 'ã”ç›¸è«‡ã—ãªãŒã‚‰æ±ºã‚ã¾ã—ã‚‡ã†'
  };
  await addMsg('bot', `${studioNames[studio]}ã§ã™ã­ï¼`);
  showRichMessage(planKey);
}

async function showRichMessage(planKey) {
  const plan = PLANS[planKey];

  addStepIndicator('â€” Step 4: äºˆç´„ãƒ»ç›¸è«‡ â€”');

  // Social proof message
  const proofMessages = {
    newborn: 'å…ˆæœˆã¯32çµ„ã®ãƒãƒã«ã”åˆ©ç”¨ã„ãŸã ãã¾ã—ãŸ',
    omiyamairi: 'è¨ªå•ç€ã®ç€ä»˜ã‘ã‚‚ç„¡æ–™ã§å¯¾å¿œã—ã¦ã„ã¾ã™',
    shichigosan: 'å‰æ’®ã‚Šãªã‚‰æ··é›‘å‰ã«ã‚†ã£ãã‚Šæ’®å½±ã§ãã¾ã™',
    birthday: 'è¡£è£…ãƒã‚§ãƒ³ã‚¸ã§2ã¤ã®é›°å›²æ°—ã‚’æ¥½ã—ã‚ã¾ã™'
  };
  await addMsg('bot', proofMessages[planKey], 600);

  addRichMsg(plan);
}

async function handleCTA(type) {
  if (type === 'reservation') {
    await addMsg('user', 'ç©ºãçŠ¶æ³ã‚’è¦‹ãŸã„');
    await addMsg('bot', 'ä»Šæœˆã®ç©ºãçŠ¶æ³ã‚’ãŠèª¿ã¹ã—ã¾ã™ã­ï¼\n\nã”å¸Œæœ›ã®æ—¥ç¨‹ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿå¹³æ—¥ã¯æ¯”è¼ƒçš„ç©ºããŒã‚ã‚Šã¾ã™ã€‚');
    await addMsg('bot', 'ã“ã¡ã‚‰ã‹ã‚‰ã”äºˆç´„ã„ãŸã ã‘ã¾ã™\nhttps://select-type.com/rsv/?id=...', 600);
    addStepIndicator('âœ… äºˆç´„ãƒ•ãƒ­ãƒ¼ã¸ç§»è¡Œ');
  } else {
    await addMsg('user', 'LINEã§ç›¸è«‡ã—ãŸã„');
    await addMsg('bot', 'ã‚‚ã¡ã‚ã‚“ã§ã™ï¼ã©ã‚“ãªã“ã¨ã§ã‚‚ãŠæ°—è»½ã«ã©ã†ãã€‚\n\næ’®å½±å†…å®¹ãƒ»è¡£è£…ãƒ»æ—¥ç¨‹ãªã©ã€ä½•ã§ã‚‚ã”ç›¸è«‡ãã ã•ã„ã€‚ã‚¹ã‚¿ãƒƒãƒ•ãŒä¸å¯§ã«ãŠç­”ãˆã—ã¾ã™ã€‚');
    addStepIndicator('âœ… ã‚¹ã‚¿ãƒƒãƒ•å¯¾å¿œã¸ç§»è¡Œ');
  }
}

function resetFlow() {
  chat.innerHTML = '';
  currentStep = 0;
  startFlow();
}

startFlow();
</script>
</body>
</html>
