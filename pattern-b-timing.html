<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒ‘ã‚¿ãƒ¼ãƒ³B: ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãƒ™ãƒ¼ã‚¹ - ãƒ’ã‚«ãƒªãƒã‚¹ã‚¿ã‚¸ã‚ª LINE ãƒ‡ãƒ¢</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, 'Hiragino Sans', sans-serif; background: #7494C0; display: flex; justify-content: center; padding: 20px 10px; }
.phone { width: 390px; height: 844px; background: #fff; border-radius: 40px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.3); display: flex; flex-direction: column; }
.header { background: #fff; padding: 50px 16px 12px; display: flex; align-items: center; gap: 12px; border-bottom: 1px solid #e5e5e5; flex-shrink: 0; }
.header .back { font-size: 24px; color: #06C755; cursor: pointer; }
.header .avatar { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #ff6b9d, #ff8fab); display: flex; align-items: center; justify-content: center; color: #fff; font-size: 14px; font-weight: bold; }
.header .name { font-size: 16px; font-weight: 600; }
.header .badge { background: #06C755; color: #fff; font-size: 9px; padding: 2px 6px; border-radius: 8px; margin-left: 4px; }
.chat { flex: 1; overflow-y: auto; padding: 16px; display: flex; flex-direction: column; gap: 8px; background: #7494C0; }
.msg { max-width: 80%; animation: fadeIn 0.3s ease; }
.msg.bot { align-self: flex-start; }
.msg.user { align-self: flex-end; }
.msg .bubble { padding: 10px 14px; border-radius: 18px; font-size: 14px; line-height: 1.6; word-break: break-word; }
.msg.bot .bubble { background: #fff; color: #333; border-bottom-left-radius: 4px; }
.msg.user .bubble { background: #06C755; color: #fff; border-bottom-right-radius: 4px; }
.msg .time { font-size: 10px; color: rgba(255,255,255,0.7); margin-top: 2px; padding: 0 4px; }
.msg.bot .time { text-align: left; }
.msg.user .time { text-align: right; }
.choices { display: flex; flex-direction: column; gap: 8px; max-width: 85%; align-self: flex-start; animation: fadeIn 0.3s ease; }
.choices button { background: #fff; border: 2px solid #06C755; color: #06C755; padding: 12px 20px; border-radius: 24px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; text-align: left; }
.choices button:hover { background: #06C755; color: #fff; }
.choices button:active { transform: scale(0.97); }
.rich-msg { max-width: 85%; align-self: flex-start; background: #fff; border-radius: 14px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.08); animation: fadeIn 0.3s ease; }
.rich-msg .rich-header { padding: 16px; color: #fff; }
.rich-msg .rich-body { padding: 14px; }
.rich-msg .rich-body .feat { display: flex; align-items: center; gap: 8px; padding: 6px 0; font-size: 13px; color: #555; }
.rich-msg .rich-body .feat::before { content: "âœ“"; color: #06C755; font-weight: bold; font-size: 16px; }
.rich-msg .urgency { background: #fff3e0; padding: 10px 14px; font-size: 12px; color: #e65100; font-weight: 500; border-top: 1px solid #ffe0b2; display: flex; align-items: center; gap: 6px; }
.rich-msg .social-proof { background: #fff9fb; padding: 10px 14px; font-size: 12px; color: #ff6b9d; font-weight: 500; border-top: 1px solid #ffeef5; }
.rich-msg .cta-row { display: flex; border-top: 1px solid #eee; }
.rich-msg .cta-row button { flex: 1; padding: 12px; border: none; font-size: 13px; font-weight: 600; cursor: pointer; transition: background 0.2s; }
.rich-msg .cta-row .cta-primary { background: #06C755; color: #fff; }
.rich-msg .cta-row .cta-primary:hover { background: #05b04c; }
.rich-msg .cta-row .cta-secondary { background: #fff; color: #06C755; }
.rich-msg .cta-row .cta-secondary:hover { background: #f0faf4; }
.timeline { max-width: 85%; align-self: flex-start; background: #fff; border-radius: 14px; padding: 16px; animation: fadeIn 0.3s ease; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
.timeline h4 { font-size: 14px; color: #333; margin-bottom: 12px; }
.timeline .tl-item { display: flex; gap: 12px; padding: 8px 0; }
.timeline .tl-dot { width: 12px; height: 12px; border-radius: 50%; margin-top: 4px; flex-shrink: 0; }
.timeline .tl-dot.active { background: #ff6b9d; box-shadow: 0 0 0 4px #ffeef5; }
.timeline .tl-dot.future { background: #ddd; }
.timeline .tl-content { flex: 1; }
.timeline .tl-content .tl-title { font-size: 13px; font-weight: 600; color: #333; }
.timeline .tl-content .tl-desc { font-size: 11px; color: #888; margin-top: 2px; }
.timeline .tl-content .tl-highlight { font-size: 12px; color: #ff6b9d; font-weight: 500; margin-top: 4px; }
.bundle-msg { max-width: 85%; align-self: flex-start; background: #fff; border-radius: 14px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.08); animation: fadeIn 0.3s ease; }
.bundle-msg .bundle-header { background: linear-gradient(135deg, #ff6b9d, #c06bc7); padding: 14px 16px; color: #fff; }
.bundle-msg .bundle-header h4 { font-size: 14px; }
.bundle-msg .bundle-header .bundle-tag { display: inline-block; background: rgba(255,255,255,0.25); padding: 2px 8px; border-radius: 10px; font-size: 10px; margin-top: 4px; }
.bundle-msg .bundle-body { padding: 14px; }
.bundle-msg .bundle-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #f5f5f5; }
.bundle-msg .bundle-item:last-child { border-bottom: none; }
.bundle-msg .bundle-item .bi-name { font-size: 13px; color: #333; }
.bundle-msg .bundle-item .bi-price { font-size: 13px; color: #999; text-decoration: line-through; }
.bundle-msg .bundle-total { background: #fff9fb; padding: 12px 14px; display: flex; justify-content: space-between; align-items: center; }
.bundle-msg .bundle-total .bt-label { font-size: 13px; color: #666; }
.bundle-msg .bundle-total .bt-price { font-size: 20px; font-weight: 700; color: #ff6b9d; }
.step-indicator { text-align: center; padding: 8px; font-size: 11px; color: rgba(255,255,255,0.7); }
.typing { align-self: flex-start; animation: fadeIn 0.3s ease; }
.typing .bubble { background: #fff; border-radius: 18px; border-bottom-left-radius: 4px; padding: 12px 18px; display: flex; gap: 4px; }
.typing .dot { width: 8px; height: 8px; background: #ccc; border-radius: 50%; animation: typingDot 1.4s infinite; }
.typing .dot:nth-child(2) { animation-delay: 0.2s; }
.typing .dot:nth-child(3) { animation-delay: 0.4s; }
.input-bar { background: #fff; padding: 8px 12px 30px; display: flex; align-items: center; gap: 8px; border-top: 1px solid #e5e5e5; flex-shrink: 0; }
.input-bar input { flex: 1; padding: 10px 16px; border: 1px solid #ddd; border-radius: 20px; font-size: 14px; outline: none; }
.input-bar .send { width: 36px; height: 36px; background: #06C755; border: none; border-radius: 50%; color: #fff; font-size: 18px; cursor: pointer; }
.debug-bar { background: #333; color: #aaa; padding: 8px 16px; font-size: 11px; display: flex; justify-content: space-between; flex-shrink: 0; }
.debug-bar .reset { color: #ff6b6b; cursor: pointer; text-decoration: underline; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
@keyframes typingDot { 0%, 60%, 100% { transform: translateY(0); } 30% { transform: translateY(-6px); } }
</style>
</head>
<body>
<div class="phone">
  <div class="header">
    <span class="back">&lsaquo;</span>
    <div class="avatar">H</div>
    <div>
      <span class="name">ãƒ’ã‚«ãƒªãƒã‚¹ã‚¿ã‚¸ã‚ª</span>
      <span class="badge">å…¬å¼</span>
    </div>
  </div>
  <div class="chat" id="chat"></div>
  <div class="input-bar">
    <input type="text" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›" disabled>
    <button class="send">&#9654;</button>
  </div>
  <div class="debug-bar">
    <span>ãƒ‘ã‚¿ãƒ¼ãƒ³B: ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãƒ™ãƒ¼ã‚¹ï¼ˆWhenå‹ï¼‰â˜…æ¨å¥¨</span>
    <span class="reset" onclick="resetFlow()">ãƒªã‚»ãƒƒãƒˆ</span>
  </div>
</div>

<script>
const chat = document.getElementById('chat');

function addMsg(type, text, delay) {
  return new Promise(resolve => {
    if (type === 'bot') {
      const typing = document.createElement('div');
      typing.className = 'typing';
      typing.innerHTML = '<div class="bubble"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>';
      chat.appendChild(typing);
      scrollDown();
      setTimeout(() => {
        typing.remove();
        const div = document.createElement('div');
        div.className = 'msg bot';
        div.innerHTML = `<div class="bubble">${text}</div><div class="time">${getTime()}</div>`;
        chat.appendChild(div);
        scrollDown();
        resolve();
      }, delay || 800);
    } else {
      const div = document.createElement('div');
      div.className = 'msg user';
      div.innerHTML = `<div class="bubble">${text}</div><div class="time">${getTime()}</div>`;
      chat.appendChild(div);
      scrollDown();
      setTimeout(resolve, 300);
    }
  });
}

function addChoices(options, callback) {
  const div = document.createElement('div');
  div.className = 'choices';
  options.forEach(opt => {
    const btn = document.createElement('button');
    btn.textContent = opt.label;
    btn.onclick = () => { div.remove(); addMsg('user', opt.label).then(() => callback(opt.value)); };
    div.appendChild(btn);
  });
  chat.appendChild(div);
  scrollDown();
}

function addTimeline(items) {
  const div = document.createElement('div');
  div.className = 'timeline';
  div.innerHTML = `<h4>ğŸ“… ãŠå­æ§˜ã®æˆé•·ã¨æ’®å½±ã‚¿ã‚¤ãƒŸãƒ³ã‚°</h4>` +
    items.map(item => `
      <div class="tl-item">
        <div class="tl-dot ${item.active ? 'active' : 'future'}"></div>
        <div class="tl-content">
          <div class="tl-title">${item.title}</div>
          <div class="tl-desc">${item.desc}</div>
          ${item.highlight ? `<div class="tl-highlight">${item.highlight}</div>` : ''}
        </div>
      </div>
    `).join('');
  chat.appendChild(div);
  scrollDown();
}

function addRichMsg(config) {
  const div = document.createElement('div');
  div.className = 'rich-msg';
  div.innerHTML = `
    <div class="rich-header" style="background: ${config.gradient}">
      <h3>${config.title}</h3>
      <p>${config.subtitle}</p>
    </div>
    <div class="rich-body">
      ${config.features.map(f => `<div class="feat">${f}</div>`).join('')}
    </div>
    ${config.urgency ? `<div class="urgency">â° ${config.urgency}</div>` : ''}
    ${config.proof ? `<div class="social-proof">${config.proof}</div>` : ''}
    <div class="cta-row">
      <button class="cta-primary" onclick="handleCTA('reservation')">ç©ºãçŠ¶æ³ã‚’è¦‹ã‚‹</button>
      <button class="cta-secondary" onclick="handleCTA('consult')">LINEã§ç›¸è«‡</button>
    </div>
  `;
  chat.appendChild(div);
  scrollDown();
}

function addBundleMsg(config) {
  const div = document.createElement('div');
  div.className = 'bundle-msg';
  div.innerHTML = `
    <div class="bundle-header">
      <h4>${config.title}</h4>
      <span class="bundle-tag">${config.tag}</span>
    </div>
    <div class="bundle-body">
      ${config.items.map(item => `
        <div class="bundle-item">
          <span class="bi-name">${item.name}</span>
          <span class="bi-price">${item.originalPrice}</span>
        </div>
      `).join('')}
    </div>
    <div class="bundle-total">
      <span class="bt-label">ã‚»ãƒƒãƒˆä¾¡æ ¼</span>
      <span class="bt-price">&yen;${config.totalPrice}<small>ï¼ˆç¨è¾¼ï¼‰</small></span>
    </div>
    <div class="cta-row" style="border-top: 1px solid #eee;">
      <button class="cta-primary" style="background:#ff6b9d;" onclick="handleCTA('reservation')">ã“ã®ãƒ—ãƒ©ãƒ³ã§äºˆç´„</button>
      <button class="cta-secondary" onclick="handleCTA('consult')">ç›¸è«‡ã™ã‚‹</button>
    </div>
  `;
  chat.appendChild(div);
  scrollDown();
}

function addStepIndicator(text) {
  const div = document.createElement('div');
  div.className = 'step-indicator';
  div.textContent = text;
  chat.appendChild(div);
  scrollDown();
}

function scrollDown() { setTimeout(() => chat.scrollTop = chat.scrollHeight, 50); }
function getTime() { const n = new Date(); return `${n.getHours()}:${String(n.getMinutes()).padStart(2, '0')}`; }

// === FLOW ===

async function startFlow() {
  addStepIndicator('â€” Step 1: ãŠå­æ§˜ã®çŠ¶æ³ã‚’æŠŠæ¡ â€”');
  await addMsg('bot', 'ãƒ’ã‚«ãƒªãƒã‚¹ã‚¿ã‚¸ã‚ªå…¬å¼LINEã¸ã‚ˆã†ã“ãï¼');
  await addMsg('bot', 'ãŠå­æ§˜ã®ä»Šã®çŠ¶æ³ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚\nã´ã£ãŸã‚Šã®æ’®å½±ãƒ—ãƒ©ãƒ³ã‚’ã”ææ¡ˆã—ã¾ã™ã€‚', 600);

  addChoices([
    { label: 'ğŸ¤° å¦Šå¨ ä¸­ã§ã™', value: 'pregnant' },
    { label: 'ğŸ‘¶ ç”Ÿå¾Œ1ãƒ¶æœˆä»¥å†…', value: 'newborn' },
    { label: 'ğŸ‘§ 1ã€œ2æ­³', value: 'toddler' },
    { label: 'ğŸ§’ 3ã€œ7æ­³', value: 'child' },
    { label: 'ğŸ“· ãã®ä»–ã®æ’®å½±', value: 'other' }
  ], handleTiming);
}

async function handleTiming(timing) {
  switch(timing) {
    case 'pregnant': return flowPregnant();
    case 'newborn': return flowNewborn();
    case 'toddler': return flowToddler();
    case 'child': return flowChild();
    case 'other': return flowOther();
  }
}

// --- å¦Šå¨ ä¸­ãƒ•ãƒ­ãƒ¼ ---
async function flowPregnant() {
  addStepIndicator('â€” Step 2: å¦Šå¨ ä¸­ã®ãƒãƒã¸ â€”');

  await addMsg('bot', 'ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼\n\nå‡ºç”£å¾Œã®æ’®å½±ã‚’ä»Šã‹ã‚‰æº–å‚™ã—ã¦ãŠãã¨å®‰å¿ƒã§ã™ã€‚');

  addTimeline([
    { title: 'å¦Šå¨ ä¸­ï¼ˆä»Šï¼‰', desc: 'ãƒã‚¿ãƒ‹ãƒ†ã‚£ãƒ•ã‚©ãƒˆæ’®å½±ã‚‚å¯èƒ½', active: true, highlight: 'â†’ ä»Šãªã‚‰ä½™è£•ã‚’ã‚‚ã£ã¦æº–å‚™ã§ãã¾ã™' },
    { title: 'ç”Ÿå¾Œ7ã€œ21æ—¥', desc: 'ãƒ‹ãƒ¥ãƒ¼ãƒœãƒ¼ãƒ³æ’®å½±ã®æœ€é©æœŸé–“', active: false, highlight: 'â†’ ã“ã®æœŸé–“ã‚’é€ƒã™ã¨æ–°ç”Ÿå…ã‚‰ã—ã„ãƒãƒ¼ã‚ºãŒé›£ã—ããªã‚Šã¾ã™' },
    { title: 'ç”Ÿå¾Œ1ãƒ¶æœˆ', desc: 'ãŠå®®å‚ã‚Šæ’®å½±', active: false },
    { title: 'ç”Ÿå¾Œ6ãƒ¶æœˆ', desc: 'ãƒãƒ¼ãƒ•ãƒãƒ¼ã‚¹ãƒ‡ãƒ¼', active: false },
    { title: '1æ­³', desc: 'ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆãƒãƒ¼ã‚¹ãƒ‡ãƒ¼', active: false }
  ]);

  await new Promise(r => setTimeout(r, 1500));

  await addMsg('bot', 'ãƒ‹ãƒ¥ãƒ¼ãƒœãƒ¼ãƒ³æ’®å½±ã¯ç”Ÿå¾Œ2ã€œ3é€±é–“ãŒãƒ™ã‚¹ãƒˆã‚¿ã‚¤ãƒŸãƒ³ã‚°ã€‚\n\nå‡ºç”£å‰ã«ã”äºˆç´„ã„ãŸã ã‘ã‚Œã°ã€å‡ºç”£å¾Œã«ãŠæ—¥ã«ã¡ã‚’èª¿æ•´ã§ãã¾ã™ã€‚', 800);

  addStepIndicator('â€” Step 3: ãƒ—ãƒ©ãƒ³ææ¡ˆ â€”');

  await addMsg('bot', 'å¦Šå¨ ä¸­ã®ã”äºˆç´„ãŒä¸€ç•ªã‚¹ãƒ ãƒ¼ã‚ºã§ã™ã€‚', 600);

  addChoices([
    { label: 'ğŸ‘¶ ãƒ‹ãƒ¥ãƒ¼ãƒœãƒ¼ãƒ³æ’®å½±ã‚’äºˆç´„ã—ãŸã„', value: 'nb' },
    { label: 'ğŸ¤° ãƒã‚¿ãƒ‹ãƒ†ã‚£ãƒ•ã‚©ãƒˆã‚‚æ’®ã‚ŠãŸã„', value: 'maternity' },
    { label: 'â›©ï¸ ãŠå®®å‚ã‚Šã‚‚ä¸€ç·’ã«ç›¸è«‡ã—ãŸã„', value: 'bundle' },
    { label: 'ğŸ¤” ã‚‚ã†å°‘ã—è€ƒãˆãŸã„', value: 'later' }
  ], handlePregnantChoice);
}

async function handlePregnantChoice(choice) {
  addStepIndicator('â€” Step 4: äºˆç´„ãƒ»ç›¸è«‡ â€”');

  if (choice === 'nb') {
    addRichMsg({
      gradient: 'linear-gradient(135deg, #ff6b9d, #ff8fab)',
      title: 'ğŸ‘¶ ãƒ‹ãƒ¥ãƒ¼ãƒœãƒ¼ãƒ³ãƒ•ã‚©ãƒˆ',
      subtitle: 'ã‚¹ã‚¿ã‚¸ã‚ªplan Â¥33,000ï¼ˆç¨è¾¼ï¼‰',
      features: ['50ã‚«ãƒƒãƒˆï¼ˆãƒ¬ã‚¿ãƒƒãƒ10+èª¿æ•´40ï¼‰', 'è¡£è£…ãƒ»å°ç‰©ã™ã¹ã¦ç„¡æ–™', 'å®Œå…¨è²¸åˆ‡ ç´„1æ™‚é–“45åˆ†', 'å‡ºç”£å¾Œã«ãŠæ—¥ã«ã¡èª¿æ•´OK'],
      urgency: 'ç”Ÿå¾Œ2ã€œ3é€±é–“ã‚’é€ƒã™ã¨æ’®å½±ãŒé›£ã—ããªã‚Šã¾ã™',
      proof: 'å¹´é–“500çµ„ä»¥ä¸Šã®ãƒãƒã«ã”åˆ©ç”¨ã„ãŸã ã„ã¦ã„ã¾ã™'
    });
  } else if (choice === 'maternity') {
    addRichMsg({
      gradient: 'linear-gradient(135deg, #c06bc7, #e8a0e8)',
      title: 'ğŸ¤° ãƒã‚¿ãƒ‹ãƒ†ã‚£ãƒ•ã‚©ãƒˆ',
      subtitle: 'Â¥33,000ï¼ˆç¨è¾¼ï¼‰',
      features: ['60ã‚«ãƒƒãƒˆæ’®å½±', 'å¤«å©¦æ’®å½±ã‚µãƒ¼ãƒ“ã‚¹', 'ç§æœ+ãŠç€æ›¿ãˆ1ç€', 'å¹³æ—¥ãƒ»åœŸæ›œã®ã¿'],
      proof: 'ä¸€ç”Ÿã«ä¸€åº¦ã®ãƒã‚¿ãƒ‹ãƒ†ã‚£æœŸã‚’å½¢ã«æ®‹ã›ã¾ã™'
    });
  } else if (choice === 'bundle') {
    await addMsg('bot', 'ãƒ‹ãƒ¥ãƒ¼ãƒœãƒ¼ãƒ³ï¼‹ãŠå®®å‚ã‚Šã®ã‚»ãƒƒãƒˆæ’®å½±ã€ç´ æ™´ã‚‰ã—ã„é¸æŠã§ã™ï¼');
    addBundleMsg({
      title: 'ãƒ‹ãƒ¥ãƒ¼ãƒœãƒ¼ãƒ³ï¼‹ãŠå®®å‚ã‚Š',
      tag: 'ç¶šã‘ã¦æ’®å½±ã•ã‚Œã‚‹ãƒãƒã«äººæ°—',
      items: [
        { name: 'ğŸ‘¶ ãƒ‹ãƒ¥ãƒ¼ãƒœãƒ¼ãƒ³ãƒ•ã‚©ãƒˆï¼ˆ50ã‚«ãƒƒãƒˆï¼‰', originalPrice: 'Â¥33,000' },
        { name: 'â›©ï¸ ãŠå®®å‚ã‚Šæ’®å½±ï¼ˆ60ã‚«ãƒƒãƒˆï¼‰', originalPrice: 'Â¥33,000' },
        { name: 'ğŸ‘˜ è¨ªå•ç€ãƒ¬ãƒ³ã‚¿ãƒ«ï¼‹ç€ä»˜ã‘', originalPrice: 'ç„¡æ–™' }
      ],
      totalPrice: '66,000'
    });
    await new Promise(r => setTimeout(r, 500));
    await addMsg('bot', 'ãŠå®®å‚ã‚Šã§ã¯è¨ªå•ç€ã®ç€ä»˜ã‘ã‚‚ç„¡æ–™ã§å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚\nç¥ç¤¾ãƒ­ã‚±ãªã‚‰æ’®å½±å½“æ—¥ã«ãã®ã¾ã¾ãŠå‚ã‚Šã§ãã¾ã™ã€‚', 600);
  } else {
    await addMsg('bot', 'ã‚‚ã¡ã‚ã‚“ã§ã™ï¼ã‚†ã£ãã‚Šã”æ¤œè¨ãã ã•ã„ã€‚\n\nã„ã¤ã§ã‚‚ã“ã®LINEã‹ã‚‰ã”ç›¸è«‡ã„ãŸã ã‘ã¾ã™ã€‚\n\nå‡ºç”£ãŒè¿‘ã¥ã„ã¦ããŸã‚‰ãŠå£°ãŒã‘ãã ã•ã„ã­ã€‚');
  }
}

// --- ç”Ÿå¾Œ1ãƒ¶æœˆä»¥å†…ãƒ•ãƒ­ãƒ¼ ---
async function flowNewborn() {
  addStepIndicator('â€” Step 2: æ–°ç”Ÿå…ãƒãƒã¸ â€”');

  await addMsg('bot', 'ã”å‡ºç”£ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼\n\nä»Šã ã‹ã‚‰ã“ãæ’®ã‚Œã‚‹å†™çœŸãŒã‚ã‚Šã¾ã™ã€‚');
  await addMsg('bot', 'èµ¤ã¡ã‚ƒã‚“ã®æˆé•·ã¯æœ¬å½“ã«æ—©ã„ã§ã™ã‚ˆã­ã€‚\næ–°ç”Ÿå…ã®ã“ã®è¡¨æƒ…ã€ã“ã®ã‚µã‚¤ã‚ºæ„Ÿã¯ä»Šã ã‘ã®ã‚‚ã®ã€‚', 800);

  addChoices([
    { label: 'ğŸ‘¶ ãƒ‹ãƒ¥ãƒ¼ãƒœãƒ¼ãƒ³æ’®å½±ãŒã—ãŸã„', value: 'nb' },
    { label: 'â›©ï¸ ãŠå®®å‚ã‚Šã®æ’®å½±ãŒã—ãŸã„', value: 'omiya' },
    { label: 'ğŸ€ ä¸¡æ–¹ã¾ã¨ã‚ã¦ç›¸è«‡ã—ãŸã„', value: 'both' }
  ], handleNewbornChoice);
}

async function handleNewbornChoice(choice) {
  addStepIndicator('â€” Step 3: ãƒ—ãƒ©ãƒ³ææ¡ˆ â€”');

  if (choice === 'nb') {
    await addMsg('bot', 'èµ¤ã¡ã‚ƒã‚“ã®ãƒšãƒ¼ã‚¹ã«åˆã‚ã›ã¦æ’®å½±ã™ã‚‹ã®ã§ã€ã‚†ã£ãŸã‚Šéã”ã—ã¦ã„ãŸã ã‘ã¾ã™ã€‚');
    addRichMsg({
      gradient: 'linear-gradient(135deg, #ff6b9d, #ff8fab)',
      title: 'ğŸ‘¶ ãƒ‹ãƒ¥ãƒ¼ãƒœãƒ¼ãƒ³ãƒ•ã‚©ãƒˆ',
      subtitle: 'ã‚¹ã‚¿ã‚¸ã‚ªplan Â¥33,000ï¼ˆç¨è¾¼ï¼‰',
      features: ['50ã‚«ãƒƒãƒˆï¼ˆãƒ¬ã‚¿ãƒƒãƒ10+èª¿æ•´40ï¼‰', 'è¡£è£…ãƒ»å°ç‰©ã™ã¹ã¦ç„¡æ–™', 'å®Œå…¨è²¸åˆ‡ ç´„1æ™‚é–“45åˆ†', 'å®¶æ—å†™çœŸãƒ»å…„å¼Ÿæ’®å½±OK'],
      urgency: 'ç”Ÿå¾Œ3é€±é–“ã‚’éãã‚‹ã¨æ–°ç”Ÿå…ã‚‰ã—ã„ãƒãƒ¼ã‚ºãŒé›£ã—ããªã‚Šã¾ã™',
      proof: 'èµ¤ã¡ã‚ƒã‚“ã®ãƒšãƒ¼ã‚¹ã«åˆã‚ã›ãŸæ’®å½±ã§å®‰å¿ƒ'
    });
  } else if (choice === 'omiya') {
    await addMsg('bot', 'ãŠå®®å‚ã‚Šã¯è¨ªå•ç€ã®ç€ä»˜ã‘ã‚‚ç„¡æ–™ã§å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚\nç¥ç¤¾ãƒ­ã‚±ãªã‚‰1æ—¥ã§å…¨éƒ¨å®Œçµã—ã¾ã™ã€‚');
    addChoices([
      { label: 'ğŸ“ ä¸‹åŒ—æ–¹ï¼ˆå®®å´ç¥å®®ã§ãƒ­ã‚±ï¼‰', value: 'shimokitakata' },
      { label: 'ğŸ“ éƒ½åŸï¼ˆç¥æŸ±å®®ã§ãƒ­ã‚±ï¼‰', value: 'miyakonojo' },
      { label: 'ğŸ“· ã‚¹ã‚¿ã‚¸ã‚ªã®ã¿ã§OK', value: 'studio' }
    ], async (studio) => {
      addStepIndicator('â€” Step 4: äºˆç´„ãƒ»ç›¸è«‡ â€”');
      const studioInfo = {
        shimokitakata: 'å®®å´ç¥å®®ã¯æœ¨æ¼ã‚Œæ—¥ã¨å‚é“ã®é›°å›²æ°—ãŒç´ æ•µã§ã™',
        miyakonojo: 'ç¥æŸ±å®®ã¯ç™½ã„é³¥å±…ã¨åºƒã„å‚é“ãŒç‰¹å¾´ã§ã™',
        studio: 'ã‚¹ã‚¿ã‚¸ã‚ªã§ã‚†ã£ãã‚Šæ’®å½±ã—ã¾ã—ã‚‡ã†'
      };
      await addMsg('bot', studioInfo[studio]);
      addRichMsg({
        gradient: 'linear-gradient(135deg, #4a90d9, #7ab8e8)',
        title: 'â›©ï¸ ãŠå®®å‚ã‚Šæ’®å½±',
        subtitle: 'ãƒ™ãƒ¼ã‚·ãƒƒã‚¯ãƒ—ãƒ©ãƒ³ Â¥33,000ï¼ˆç¨è¾¼ï¼‰',
        features: ['60ã‚«ãƒƒãƒˆï¼ˆæ˜ã‚‹ã•ãƒ»è‰²å‘³èª¿æ•´æ¸ˆã¿ï¼‰', 'ç”£ç€ãƒ»è¨ªå•ç€ãƒ¬ãƒ³ã‚¿ãƒ«ç„¡æ–™', 'ç€ä»˜ã‘ã‚¹ã‚¿ãƒƒãƒ•ãŒå¯¾å¿œ', 'å…„å¼Ÿè¡£è£…1ç€ç„¡æ–™', studio !== 'studio' ? 'ç¥ç¤¾ãƒ­ã‚±æ’®å½±ï¼ˆ1æ—¥ã§å®Œçµï¼‰' : 'å®Œå…¨è²¸åˆ‡ã‚¹ã‚¿ã‚¸ã‚ª'],
        proof: 'ç”£ç€ã®ç€ã›æ–¹ã‚‚ãŠä»»ã›ãã ã•ã„'
      });
    });
  } else {
    await addMsg('bot', 'ãƒ‹ãƒ¥ãƒ¼ãƒœãƒ¼ãƒ³â†’ãŠå®®å‚ã‚Šã®æµã‚Œã§æ’®å½±ã•ã‚Œã‚‹ãƒãƒã€å¤šã„ã§ã™ï¼');
    addBundleMsg({
      title: 'ãƒ‹ãƒ¥ãƒ¼ãƒœãƒ¼ãƒ³ï¼‹ãŠå®®å‚ã‚Šã‚»ãƒƒãƒˆ',
      tag: 'åŒã˜ã‚¹ã‚¿ã‚¸ã‚ªã§å®‰å¿ƒ',
      items: [
        { name: 'ğŸ‘¶ ãƒ‹ãƒ¥ãƒ¼ãƒœãƒ¼ãƒ³ãƒ•ã‚©ãƒˆï¼ˆ50ã‚«ãƒƒãƒˆï¼‰', originalPrice: 'Â¥33,000' },
        { name: 'â›©ï¸ ãŠå®®å‚ã‚Šæ’®å½±ï¼ˆ60ã‚«ãƒƒãƒˆï¼‰', originalPrice: 'Â¥33,000' },
        { name: 'ğŸ‘˜ è¨ªå•ç€ãƒ¬ãƒ³ã‚¿ãƒ«ï¼‹ç€ä»˜ã‘', originalPrice: 'ç„¡æ–™' }
      ],
      totalPrice: '66,000'
    });
  }
}

// --- 1ã€œ2æ­³ãƒ•ãƒ­ãƒ¼ ---
async function flowToddler() {
  addStepIndicator('â€” Step 2: 1ã€œ2æ­³ã®ãŠå­æ§˜ â€”');

  await addMsg('bot', '1ã€œ2æ­³ã¯ã¨ã£ã¦ã‚‚å¯æ„›ã„æ™‚æœŸã§ã™ã­ï¼\n\næ­©ãå§‹ã‚ãŸã‚Šã€è¡¨æƒ…ãŒè±Šã‹ã«ãªã£ãŸã‚Šã€‚\nã“ã®æˆé•·ã‚’å†™çœŸã«æ®‹ã—ã¾ã›ã‚“ã‹ï¼Ÿ');

  addChoices([
    { label: 'ğŸ‚ ãƒãƒ¼ã‚¹ãƒ‡ãƒ¼æ’®å½±', value: 'birthday' },
    { label: 'ğŸ€ ãƒãƒ¼ãƒ•ãƒãƒ¼ã‚¹ãƒ‡ãƒ¼', value: 'half' },
    { label: 'ğŸ“· è¨˜å¿µæ’®å½±ï¼ˆç‰¹ã«ç†ç”±ãªã—ï¼‰', value: 'casual' },
    { label: 'â›©ï¸ ãŠå®®å‚ã‚ŠãŒã¾ã ã ã£ãŸ', value: 'omiya_late' }
  ], async (choice) => {
    addStepIndicator('â€” Step 3: ãƒ—ãƒ©ãƒ³ææ¡ˆ â€”');
    if (choice === 'birthday' || choice === 'half') {
      const title = choice === 'birthday' ? 'ğŸ‚ ãƒãƒ¼ã‚¹ãƒ‡ãƒ¼ãƒ•ã‚©ãƒˆ' : 'ğŸ€ ãƒãƒ¼ãƒ•ãƒãƒ¼ã‚¹ãƒ‡ãƒ¼ãƒ•ã‚©ãƒˆ';
      await addMsg('bot', choice === 'birthday'
        ? '1æ­³ã®ãƒãƒ¼ã‚¹ãƒ‡ãƒ¼ã¯ã‚¹ãƒãƒƒã‚·ãƒ¥ã‚±ãƒ¼ã‚­ã‚‚ã”ç”¨æ„ã§ãã¾ã™ï¼'
        : 'ãƒãƒ¼ãƒ•ãƒãƒ¼ã‚¹ãƒ‡ãƒ¼ã¯å¯è¿”ã‚Šå‰å¾Œã®å¯æ„›ã„æ™‚æœŸã€‚ä»ŠãŒãƒ™ã‚¹ãƒˆã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã™ï¼');
      addRichMsg({
        gradient: 'linear-gradient(135deg, #ffb347, #ffcc80)',
        title: title,
        subtitle: 'Â¥33,000ï¼ˆç¨è¾¼ï¼‰',
        features: ['60ã‚«ãƒƒãƒˆæ’®å½±', 'è¡£è£…2ç€', 'å…„å¼Ÿè¡£è£…1ç€ç„¡æ–™', choice === 'birthday' ? 'ã‚¹ãƒãƒƒã‚·ãƒ¥ã‚±ãƒ¼ã‚­å¯¾å¿œ' : 'å¯è¿”ã‚Šå‰ã®å¯æ„›ã„æ™‚æœŸã«'],
        proof: 'è¡£è£…ãƒã‚§ãƒ³ã‚¸ã§2ã¤ã®é›°å›²æ°—ã‚’æ¥½ã—ã‚ã¾ã™'
      });
    } else {
      await addMsg('bot', 'ã©ã‚“ãªç†ç”±ã§ã‚‚OKï¼æˆé•·ã®è¨˜éŒ²ã¯ä½•åº¦æ’®ã£ã¦ã‚‚è‰¯ã„ã‚‚ã®ã§ã™ã€‚');
      addRichMsg({
        gradient: 'linear-gradient(135deg, #81c784, #a5d6a7)',
        title: 'ğŸ“· è¨˜å¿µæ’®å½±',
        subtitle: 'Â¥33,000ï¼ˆç¨è¾¼ï¼‰',
        features: ['60ã‚«ãƒƒãƒˆæ’®å½±', 'è¡£è£…2ç€', 'å…„å¼Ÿè¡£è£…1ç€ç„¡æ–™', 'å®Œå…¨è²¸åˆ‡ã§ãƒªãƒ©ãƒƒã‚¯ã‚¹'],
        proof: 'å®¶æ—ã¿ã‚“ãªã®æ€ã„å‡ºã‚’å½¢ã«'
      });
    }
  });
}

// --- 3ã€œ7æ­³ãƒ•ãƒ­ãƒ¼ ---
async function flowChild() {
  addStepIndicator('â€” Step 2: 3ã€œ7æ­³ã®ãŠå­æ§˜ â€”');

  await addMsg('bot', 'ä¸ƒäº”ä¸‰ã®ã”æº–å‚™ã§ã—ã‚‡ã†ã‹ï¼Ÿ\n\nãŠå­æ§˜ã®ãŠç¥ã„ã€å¤§åˆ‡ãªç¯€ç›®ã§ã™ã­ã€‚');

  addChoices([
    { label: 'ğŸ‘§ 3æ­³ã®ä¸ƒäº”ä¸‰ï¼ˆå¥³ã®å­ï¼‰', value: '3f' },
    { label: 'ğŸ‘¦ 5æ­³ã®ä¸ƒäº”ä¸‰ï¼ˆç”·ã®å­ï¼‰', value: '5m' },
    { label: 'ğŸ‘§ 7æ­³ã®ä¸ƒäº”ä¸‰ï¼ˆå¥³ã®å­ï¼‰', value: '7f' },
    { label: 'ğŸ‚ ãƒãƒ¼ã‚¹ãƒ‡ãƒ¼æ’®å½±', value: 'bd' }
  ], async (choice) => {
    if (choice === 'bd') {
      addStepIndicator('â€” Step 3: ãƒãƒ¼ã‚¹ãƒ‡ãƒ¼ææ¡ˆ â€”');
      addRichMsg({
        gradient: 'linear-gradient(135deg, #ffb347, #ffcc80)',
        title: 'ğŸ‚ ãƒãƒ¼ã‚¹ãƒ‡ãƒ¼ãƒ•ã‚©ãƒˆ',
        subtitle: 'Â¥33,000ï¼ˆç¨è¾¼ï¼‰',
        features: ['60ã‚«ãƒƒãƒˆæ’®å½±', 'è¡£è£…2ç€', 'å…„å¼Ÿè¡£è£…1ç€ç„¡æ–™', 'å®Œå…¨è²¸åˆ‡ã§ãƒªãƒ©ãƒƒã‚¯ã‚¹'],
        proof: 'ãŠèª•ç”Ÿæ—¥ã®ç‰¹åˆ¥ãª1æ—¥ã‚’å†™çœŸã«'
      });
      return;
    }

    addStepIndicator('â€” Step 3: ä¸ƒäº”ä¸‰ãƒ—ãƒ©ãƒ³ â€”');

    const ageLabel = { '3f': '3æ­³å¥³ã®å­', '5m': '5æ­³ç”·ã®å­', '7f': '7æ­³å¥³ã®å­' };
    await addMsg('bot', `${ageLabel[choice]}ã®ä¸ƒäº”ä¸‰ã§ã™ã­ï¼\n\nãƒ˜ã‚¢ãƒ¡ã‚¤ã‚¯ãƒ»ç€ä»˜ã‘è¾¼ã¿ãªã®ã§ã€æ‰‹ã¶ã‚‰ã§OKã§ã™ã€‚`);

    addChoices([
      { label: 'ğŸ‘˜ ç€ç‰©ï¼‹æ´‹è£…ï¼ˆ2ç€ï¼‰ãŒã„ã„', value: 'double' },
      { label: 'â›©ï¸ ç¥ç¤¾ãƒ­ã‚±ã‚‚ã—ãŸã„', value: 'loca' },
      { label: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ å…„å¼Ÿã‚‚ä¸€ç·’ã«æ’®ã‚ŠãŸã„', value: 'sibling' }
    ], async (pref) => {
      addStepIndicator('â€” Step 4: äºˆç´„ãƒ»ç›¸è«‡ â€”');

      if (pref === 'double') {
        addRichMsg({
          gradient: 'linear-gradient(135deg, #e57373, #ef9a9a)',
          title: 'ğŸ ä¸ƒäº”ä¸‰ ç€ç‰©&æ´‹è£…ãƒ—ãƒ©ãƒ³',
          subtitle: 'Â¥35,000ã€œï¼ˆç¨è¾¼ï¼‰',
          features: ['60ã‚«ãƒƒãƒˆæ’®å½±', 'ç€ç‰©1ç€ï¼‹æ´‹è£…1ç€', 'ãƒ˜ã‚¢ãƒ¡ã‚¤ã‚¯ãƒ»ç€ä»˜ã‘è¾¼ã¿', 'å¸¯ãƒ»é«ªé£¾ã‚Šå«ã‚€'],
          proof: 'å‰æ’®ã‚Šãªã‚‰è¡£è£…é¸ã³æ”¾é¡Œãƒ»æ··é›‘ã‚’é¿ã‘ã‚‰ã‚Œã¾ã™'
        });
      } else if (pref === 'loca') {
        await addMsg('bot', 'ç¥ç¤¾ãƒ­ã‚±ãªã‚‰æ’®å½±â†’ãã®ã¾ã¾ãŠå‚ã‚ŠãŒ1æ—¥ã§å®Œçµã—ã¾ã™ã€‚');
        addChoices([
          { label: 'ğŸ“ å®®å´ç¥å®®ï¼ˆä¸‹åŒ—æ–¹ï¼‰', value: 'shimokitakata' },
          { label: 'ğŸ“ ç¥æŸ±å®®ï¼ˆéƒ½åŸï¼‰', value: 'miyakonojo' }
        ], async () => {
          addRichMsg({
            gradient: 'linear-gradient(135deg, #4a90d9, #7ab8e8)',
            title: 'â›©ï¸ ä¸ƒäº”ä¸‰ ã‚¹ã‚¿ã‚¸ã‚ªï¼‹ãƒ­ã‚±',
            subtitle: 'Â¥35,000ã€œï¼ˆç¨è¾¼ï¼‰',
            features: ['60ã‚«ãƒƒãƒˆï¼ˆ3ã€œ4ã‚·ãƒ¼ãƒ³ï¼‰', 'ç€ç‰©1ç€', 'ãƒ˜ã‚¢ãƒ¡ã‚¤ã‚¯ãƒ»ç€ä»˜ã‘è¾¼ã¿', 'ç¥ç¤¾ãƒ­ã‚±ã§å®¶æ—å†™çœŸ'],
            urgency: 'ç§‹ã®ä¸ƒäº”ä¸‰ã‚·ãƒ¼ã‚ºãƒ³ã¯äºˆç´„ãŒåŸ‹ã¾ã‚Šã‚„ã™ããªã‚Šã¾ã™',
            proof: 'å‰æ’®ã‚Šã§æ··é›‘ã‚’é¿ã‘ã‚‹ã®ãŒãŠã™ã™ã‚'
          });
        });
      } else {
        await addMsg('bot', 'å…„å¼Ÿæ’®å½±ã€ç´ æ•µã§ã™ã­ï¼\nãƒ™ãƒ¼ã‚·ãƒƒã‚¯ãƒ—ãƒ©ãƒ³ãªã‚‰æ´‹è£…1ç€ãŒç„¡æ–™ã§ã™ã€‚');
        addRichMsg({
          gradient: 'linear-gradient(135deg, #ff6b9d, #ff8fab)',
          title: 'ğŸ ä¸ƒäº”ä¸‰ï¼‹å…„å¼Ÿæ’®å½±',
          subtitle: 'Â¥35,000ã€œï¼ˆç¨è¾¼ï¼‰+ å…„å¼Ÿè¿½åŠ Â¥22,000',
          features: ['60ã‚«ãƒƒãƒˆæ’®å½±', 'ãƒ˜ã‚¢ãƒ¡ã‚¤ã‚¯ãƒ»ç€ä»˜ã‘è¾¼ã¿', 'å…„å¼Ÿæ´‹è£…1ç€ç„¡æ–™ï¼ˆãƒ™ãƒ¼ã‚·ãƒƒã‚¯ï¼‰', 'å®¶æ—å…¨å“¡ã§ã®è¨˜å¿µå†™çœŸ'],
          proof: 'å…„å¼Ÿã®çµ†ã‚’å†™çœŸã«æ®‹ã™å¤§åˆ‡ãªæ©Ÿä¼š'
        });
      }
    });
  });
}

// --- ãã®ä»–ãƒ•ãƒ­ãƒ¼ ---
async function flowOther() {
  addStepIndicator('â€” Step 2: ãã®ä»–ã®æ’®å½± â€”');
  await addMsg('bot', 'ã©ã‚“ãªæ’®å½±ã§ã‚‚ãŠæ°—è»½ã«ã”ç›¸è«‡ãã ã•ã„ï¼');
  addChoices([
    { label: 'ğŸ¤° ãƒã‚¿ãƒ‹ãƒ†ã‚£ãƒ•ã‚©ãƒˆ', value: 'maternity' },
    { label: 'ğŸ“ æˆäººå¼ãƒ»å…¥å­¦å’åœ’', value: 'event' },
    { label: 'ğŸ“ ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ’®å½±', value: 'location' },
    { label: 'ğŸ’¬ ç›¸è«‡ã—ãŸã„', value: 'consult' }
  ], async (choice) => {
    addStepIndicator('â€” Step 3: ã”æ¡ˆå†… â€”');
    if (choice === 'consult') {
      await addMsg('bot', 'ã©ã‚“ãªã“ã¨ã§ã‚‚ãŠæ°—è»½ã«ã©ã†ãï¼\nã‚¹ã‚¿ãƒƒãƒ•ãŒä¸å¯§ã«ãŠç­”ãˆã—ã¾ã™ã€‚');
    } else {
      await addMsg('bot', 'ã´ã£ãŸã‚Šã®ãƒ—ãƒ©ãƒ³ã‚’ã”ææ¡ˆã—ã¾ã™ã€‚\nè©³ã—ã„ã”å¸Œæœ›ã‚’ãŠèã‹ã›ãã ã•ã„ï¼');
    }
    addStepIndicator('âœ… ã‚¹ã‚¿ãƒƒãƒ•å¯¾å¿œã¸ç§»è¡Œ');
  });
}

async function handleCTA(type) {
  if (type === 'reservation') {
    await addMsg('user', 'ç©ºãçŠ¶æ³ã‚’è¦‹ãŸã„');
    await addMsg('bot', 'ä»Šæœˆã®ç©ºãçŠ¶æ³ã‚’ãŠèª¿ã¹ã—ã¾ã™ï¼\n\nã”å¸Œæœ›ã®æ—¥ç¨‹ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ\nå¹³æ—¥ã¯æ¯”è¼ƒçš„ã”äºˆç´„ãŒå–ã‚Šã‚„ã™ã„ã§ã™ã€‚');
    addStepIndicator('âœ… äºˆç´„ãƒ•ãƒ­ãƒ¼ã¸ç§»è¡Œ');
  } else {
    await addMsg('user', 'ç›¸è«‡ã—ãŸã„');
    await addMsg('bot', 'ã‚‚ã¡ã‚ã‚“ã§ã™ï¼\n\næ’®å½±å†…å®¹ãƒ»è¡£è£…ãƒ»æ—¥ç¨‹ãªã©ã€ä½•ã§ã‚‚ãŠæ°—è»½ã«ã©ã†ãã€‚\nã‚¹ã‚¿ãƒƒãƒ•ãŒä¸å¯§ã«ãŠç­”ãˆã—ã¾ã™ã€‚');
    addStepIndicator('âœ… ã‚¹ã‚¿ãƒƒãƒ•å¯¾å¿œã¸ç§»è¡Œ');
  }
}

function resetFlow() { chat.innerHTML = ''; startFlow(); }
startFlow();
</script>
</body>
</html>
